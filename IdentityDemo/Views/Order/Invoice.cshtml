@model IdentityDemo.ViewModels.InvoiceViewModel
@{
    Layout = null;
    decimal total = 0;
    decimal taxrate = 0.1m;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>

    <!-- Combined and Minimized External Resources -->
    <link rel="stylesheet" href="~/css/download_css/4_5_3_bootstrap.min.css" />
    
    
</head>
<body style="font-family: Arial, sans-serif; margin: 20px;background-color:#f0f0f0">
    <div id="invoice-container" >
        <!-- Invoice Header -->
        <div class="invoice-header" style="margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
            <div style="display: inline-block; width: 48%; vertical-align: top;">
                <table style="width: 60%;">
                    <tr>
                        <td colspan="2" style="text-align:left;"><h1>@Model.Shop.ShopName</h1></td>
                    </tr>
                    <tr>
                        <th>Address:</th>
                        <td>@Model.Shop.ShopAddress</td>
                    </tr>
                    <tr>
                        <th>Contact Details:</th>
                        <td>@Model.Shop.ShopEmail</td>
                    </tr>
                    
                </table>
            </div>
            <div style="display: inline-block; width: 48%; vertical-align: top; text-align: right;">
                
                <table style="width: 40%; float: right;">
                    <tr>
                        <td colspan="2" style="text-align: right;"><h1>Invoice</h1></td>
                    </tr>
                    <tr>
                        <th style="text-align: left;width:54%;">Invoice Id: </th>
                        <td style="text-align: right;">@Model.OrderDate.ToString("ddyyyyMM")@Model.OrderId</td>
                    </tr>
                    <tr>
                        <th style="text-align: left;">Invoice Date:</th>
                        <td style="text-align: right;">@Model.OrderDate.ToString("yyyy-MM-dd")</td>
                    </tr>
                    
                </table>
                
            </div>
        </div>

        <!-- Client Details -->
        <div class="client-details" style="margin-bottom: 20px;">
            <h2 style="margin: 0 0 10px 0;">Bill To:</h2>
            <p style="margin: 0;">Client Name: @Model.User.UserName<br>Client Address: @Model.User.Address<br>Client Contact Details: @Model.User.PhoneNumber</p>
        </div>

        <!-- Items Table -->
        <div class="items" style="margin-bottom: 20px;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Item Description</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Quantity</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Unit Price</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Items)
                    {
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemName</td>
                            <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemQuantity</td>
                            <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemChangedPrice</td>
                            <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@(item.ItemQuantity * item.ItemChangedPrice)</td>
                        </tr>
                        total += (item.ItemQuantity * item.ItemChangedPrice);
                    }
                </tbody>
            </table>
        </div>
        <div>
            <!-- Summary Section -->
            <div class="summary" style="text-align: right; margin-bottom: 20px;">
                <table style="width: 50%; float: right;">
                    <tr>
                        <th style="padding: 8px;">Subtotal:</th>
                        <td style="text-align: right; padding: 8px;">MMK @total</td>
                    </tr>
                    <tr>
                        <th style=" padding: 8px;">Taxes (10%):</th>
                        <td style="text-align: right; padding: 8px;">MMk @(total * taxrate)</td>
                    </tr>
                    <tr>
                        <th style=" padding: 8px;">Total Amount Due:</th>
                        <td style="text-align: right; padding: 8px;">MMk @(total + (total * taxrate))</td>
                    </tr>
                </table>
            </div>

            <!-- Notes Section -->
            <div class="notes" style="margin-bottom: 20px;">
                <h3 style="margin: 0 0 10px 0;">Notes:</h3>
                <p style="margin: 0;">Thank you for your business!<br>If you have any questions, please contact us at swiftfoods48@gmail.com</p>
            </div>
        </div>
         
    </div>
    <!-- Buttons for Download and Cancel -->
    <div class="d-flex justify-content-end w-100">
        <button type="button" class="btn btn-secondary cancel-button mr-2" onclick="cancelgoBackToAnotherPage()" style="width: 100px;">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="confirmAndDownload()" style="width: 100px;">Ok</button>
    </div>
    <!-- Bootstrap Modal for Thank You Message -->
    <div class="modal fade" id="thankYouModal" tabindex="-1" role="dialog" aria-labelledby="thankYouModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thankYouModalLabel">Thank You!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Your order has been saved as Image.<br />Thank you for your business!</p>
                </div>
                <div class="modal-footer">
                    
                    <form method="post" action="/Order/SendInvoiceEmail">
                        <input type="hidden" name="htmlContent" id="htmlContent" />
                        <button type="submit" class="btn btn-primary" style="width: 70px;">Ok</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    
    <script src="~/js/download_js/jquery-3.5.1.slim.min.js"></script>
    <script src="~/js/download_js/2_5_4_popper.min.js"></script>
    <script src="~/js/download_js/4_5_3_bootstrap.min.js"></script>
    <script src="~/js/download_js/html2canvas.min.js"></script>
    <!-- JavaScript for Invoice Handling -->
    <script>
        // Example of targeting body indirectly through JavaScript
        document.body.style.backgroundColor = '#f0f0f0'; // Setting background color
        // Capture HTML content of the invoice for sending via email
        var invoiceHtml = document.getElementById('invoice-container').innerHTML;
        document.getElementById('htmlContent').value = invoiceHtml;
        
        function confirmAndDownload() {
            downloadAsImage().then(function () {
                showThankYouModal();                   
                
            });
        }

        function downloadAsImage() {
            var element = document.getElementById('invoice-container');
            
            return html2canvas(element).then(function (canvas) {
                var link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'invoice.png';
                link.click();
            }).catch(function (error) {
                console.error('Error capturing invoice:', error);
                alert('Error capturing invoice. Please try again.');
            });
        }

        function showThankYouModal() {
            $('#thankYouModal').modal('show');
        }

        function goBackToAnotherPage() {
           
            window.location.href = '/Order/SaveInvoice';
        }
        function cancelgoBackToAnotherPage() {
            window.location.href = '/Hywm/Landing_page2';
        }
        
    
    </script>
</body>
</html>
