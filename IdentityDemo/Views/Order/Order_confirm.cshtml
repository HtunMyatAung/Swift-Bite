@model IdentityDemo.ViewModels.InvoiceViewModel
@{
    Layout = null;
    decimal total = 0;
    decimal taxrate = 0.1m;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Summary</title>
    <link rel="stylesheet" href="~/css/download_css/4_5_3_bootstrap.min.css"/>
   
    
    <script src="~/js/download_js/4_5_3_bootstrap.min.js"></script>
    <style>
        
        .payment-dropdown select {
            padding: 5px;
        }

            .payment-dropdown select option {
                padding: 5px;
            }

        .container1 { 
            padding: 20px;
            overflow-y: auto; 
            height: 75vh;
        }

        .container2 {
            position: sticky;
            top: 20px; 
            padding: 0 10px;
            height: 75vh;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="invoice-header" style="margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
            <div style="display: inline-block; width: 48%; vertical-align: top;">
                <table style="width: 50%;">
                    <tr>
                        <th>InvoiceId:</th>
                        <td>@Model.OrderDate.ToString("ddyyyMM")@Model.OrderId</td>
                    </tr>
                    <tr>
                        <th>Date: </th>
                        <td>@Model.OrderDate</td>
                    </tr>
                    
                </table>
                
            </div>
            <div style="display: inline-block; width: 48%; vertical-align: top; text-align: right;">
                <table style="width: 30%; float: right;">
                    
                    <tr>
                        <th style="text-align: left;width:54%;">Shop: </th>
                        <td style="text-align: right;">@Model.Shop.ShopName</td>
                    </tr>
                    <tr>
                        <th style="text-align: left;">Client:</th>
                        <td style="text-align: right;">@Model.User.UserName</td>
                    </tr>
                    <tr>
                        <th style="text-align: left;">Phone:</th>
                        <td style="text-align: right;"> @Model.User.PhoneNumber</td>
                    </tr>
                </table>
                
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-8 container1">
                <!-- Items Table -->
                <div class="items" style="margin-bottom: 20px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Item Description</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Quantity</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Unit Price</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Items)
                            {
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemName</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemQuantity</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@item.ItemChangedPrice</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;text-align:center">@(item.ItemQuantity * item.ItemChangedPrice)</td>
                                </tr>
                                total += (item.ItemQuantity * item.ItemChangedPrice);
                            }
                        </tbody>
                    </table>
                </div>
                <div>
                    <div class="d-flex justify-content-between">
                        <div class="summary" style="margin-bottom: 20px;">
                            <table>
                                <tr>
                                    <th style="padding: 8px;">Subtotal:</th>
                                    <td style="text-align: right; padding: 8px;">$@total</td>
                                </tr>
                                <tr>
                                    <th style=" padding: 8px;">Taxes (10%):</th>
                                    <td style="text-align: right; padding: 8px;">$@(total * taxrate)</td>
                                </tr>
                                <tr>
                                    <th style=" padding: 8px;">Total Amount Due:</th>
                                    <td style="text-align: right; padding: 8px;">$@(total + (total * taxrate))</td>
                                </tr>
                            </table>
                        </div>
                        <div style="padding-top: 8px;">
                            <div class="d-flex justify-content-end">
                                <div class="payment-dropdown">
                                    <select id="payment-select" style="width:264px; height: 45px; margin-right:8px;margin-bottom:10px;">
                                        <option value="kbz">KBZ pay</option>
                                        <option value="uab">uab pay</option>
                                        <option value="cashondelivery">Cash on Delivery</option>
                                    </select>
                                </div>
                            </div>
                            <form action="/Order/Invoice" method="post">
                                <input type="text" placeholder="Enter your current address" style="width:264px; height: 45px; margin-right:8px; margin-bottom:10px;" required />

                                <div class="d-flex justify-content-end" style="margin-right: 8px; margin-top: 25px;">
                                <a href="@Url.Action("HomePageItems","Item")" class="btn btn-secondary mr-1 d-flex align-items-center justify-content-center" style="width:130px;height:45px;">
                                    Cancel
                                </a>
                                <button class="btn btn-primary d-flex align-items-center justify-content-center" style="width:130px;height:45px;" type="submit">
                                    Confirm
                                </button>
                            </div>
                            </form>
                        </div>
                    </div>
                    <hr />
                    <!-- Summary Section -->
                </div>
            </div>
            <div class="col-md-4 container2">
                <!-- 40% width on medium and larger screens -->
                <div class="container2">
                    
                    <div class="d-flex justify-content-center">
                        <img id="blah" class="image-preview" src="/img/pay_qr&logo/kbz_pay_qr.jpg" alt="Preview Image" style="max-width: 400px; max-height: 450px; display: block;" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function calculateSummary() {
            const taxRate = 0.10;
            let subtotal = 0;

            const rows = document.querySelectorAll('#items-body tr');
            rows.forEach(row => {
                const totalCell = row.cells[3];
                const total = parseFloat(totalCell.textContent);
                subtotal += total;
            });

            const taxes = subtotal * taxRate;
            const totalDue = subtotal + taxes;

            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('taxes').textContent = taxes.toFixed(2);
            document.getElementById('total-due').textContent = totalDue.toFixed(2);
        }
        
        // Calculate summary on page load
        window.onload = calculateSummary;
    
        $(document).ready(function () {
            $('#payment-select').on('change', function () {
                var selectedValue = $(this).val();
                var imagePath = '';

                switch (selectedValue) {
                    case 'kbz':
                        imagePath = "/img/pay_qr&logo/kbz_pay_qr.jpg";
                        break;
                    case 'uab':
                        imagePath = "/img/pay_qr&logo/uab_pay_QR.png";
                        break;
                    case 'cashondelivery':
                        imagePath = "/img/pay_qr&logo/cod2.jpg";
                        break;
                    default:
                        imagePath = '/img/pay_qr&logo/cod2.jpg';
                }

                // Debugging output
                console.log("Selected value:", selectedValue);
                console.log("Image path:", imagePath);

                $('#blah').attr('src', imagePath);
            });
        });
  
        
    </script>

</body>
</html>
